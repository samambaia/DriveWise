{
  "entities": {
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category for expenses.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category."
        },
        "name": {
          "type": "string",
          "description": "Name of the category (e.g., 'Fuel', 'Toll')."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "RideApp": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RideApp",
      "type": "object",
      "description": "Represents a ride application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ride app."
        },
        "name": {
          "type": "string",
          "description": "Name of the ride application (e.g., 'Uber', '99')."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Period": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Period",
      "type": "object",
      "description": "Represents a financial period with a start date, end date, initial balance, and target balance.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the period."
        },
        "startDate": {
          "type": "string",
          "description": "Timestamp of the period start.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "Timestamp of the period end.",
          "format": "date-time"
        },
        "initialBalance": {
          "type": "number",
          "description": "The starting financial value for the period."
        },
        "targetBalance": {
          "type": "number",
          "description": "The final financial goal for the period."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates whether the period is currently active."
        }
      },
      "required": [
        "id",
        "startDate",
        "endDate",
        "initialBalance",
        "targetBalance",
        "isActive"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a financial transaction (revenue or expense).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction."
        },
        "type": {
          "type": "string",
          "description": "Type of transaction ('Revenue' or 'Expense')."
        },
        "amount": {
          "type": "number",
          "description": "Value of the transaction."
        },
        "description": {
          "type": "string",
          "description": "Details about the transaction."
        },
        "categoryOrAppId": {
          "type": "string",
          "description": "Reference to Category or RideApp depending on transaction type. (Relationship: Category 1:N Transaction, RideApp 1:N Transaction)"
        },
        "tripCount": {
          "type": "number",
          "description": "Number of trips (only for Revenue transactions)."
        },
        "periodId": {
          "type": "string",
          "description": "Reference to Period. (Relationship: Period 1:N Transaction)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of the transaction.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "type",
        "amount",
        "description",
        "categoryOrAppId",
        "periodId",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/settings/categories",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores expense categories. Public data, no authorization required."
        }
      },
      {
        "path": "/settings/rideApps",
        "definition": {
          "entityName": "RideApp",
          "schema": {
            "$ref": "#/backend/entities/RideApp"
          },
          "description": "Stores ride applications. Public data, no authorization required."
        }
      },
      {
        "path": "/users/{userId}/periods/{periodId}",
        "definition": {
          "entityName": "Period",
          "schema": {
            "$ref": "#/backend/entities/Period"
          },
          "description": "Stores financial periods for each user. Uses path-based ownership for authorization.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user."
            },
            {
              "name": "periodId",
              "description": "The ID of the financial period."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/periods/{periodId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Stores transactions for a specific period owned by a user. Uses path-based ownership, inheriting authorization from the parent period. Includes denormalized 'periodId' for authorization independence and efficient querying.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user."
            },
            {
              "name": "periodId",
              "description": "The ID of the financial period."
            },
            {
              "name": "transactionId",
              "description": "The ID of the transaction."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure security, scalability, and ease of debugging, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). Authorization Independence is achieved through denormalization. For instance, access to `transactions` is governed by the `periodId` which implicitly grants access based on the user's ownership of the period document. \n\nStructural Segregation is employed by separating public `settings` from user-specific data like `periods` and `transactions`. Access Modeling uses path-based ownership for user-specific data (`/users/{userId}/periods/{periodId}`).\n\nTo ensure QAPs, the collections are structured to avoid filtering on the client-side, and security rules are written to validate data based on path and data content. For example, listing transactions requires that the user has access to the `periodId` which is part of the transaction.\n\nThe settings collection stores application-level configuration data, which is considered public, whereas the periods and transaction collections store user-specific financial data."
  }
}